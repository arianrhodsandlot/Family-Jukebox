(function () {
  var prelude = {
    channels: [{
      name: 'square1',
      config: {
        instrument: {waveform: 'square', sampleRate: 44100, bpm: 300, volume: 0.2, waveEndsBy: 0.75},
        audio: {volume: 0.2}
      },
      notes: [
        [13, 3], [13, 0.5], [13, 0.5], 13, 9, 9, 13, [14, 1.5], [11, 0.5], [11, 3],
        11, 11, 14,
        [13, 3], [13, 0.5], [13, 0.5], 13, 9, 9, 13, [11, 0.5], [13, 0.5], [14, 5],
        [16, 2],
        [13, 3], [13, 0.5], [13, 0.5], 13, 9, 9, 13, [14, 1.5], [11, 0.5], [11, 3],
        11, 11, 14,
        [13, 3], [13, 0.5], [13, 0.5], 13, 9, 9, 13, [11, 0.5], [13, 0.5], [14, 5],
        [17, 2]
      ]
    }, {
      name: 'square2',
      config: {
        instrument: {waveform: 'square', sampleRate: 44100, bpm: 300, waveEndsBy: 0.7},
        audio: {volume: 0.2}
      },
      notes: [
        [9, 3], [9, 0.5], [9, 0.5], 9, 4, 4, 9, [11, 1.5], [7, 0.5], [7, 3],
        7, 7, 7,
        [9, 3], [9, 0.5], [9, 0.5], 9, 4, 4, 9, [7, 0.5], [9, 0.5], [11, 5],
        [11, 2],
        [9, 3], [9, 0.5], [9, 0.5], 9, 4, 4, 9, [11, 1.5], [7, 0.5], [7, 3],
        7, 7, 7,
        [9, 3], [9, 0.5], [9, 0.5], 9, 4, 4, 9, [7, 0.5], [9, 0.5], [11, 5],
        [11, 2]
      ]
    }, {
      name: 'triangle',
      config: {
        instrument: {waveform: 'triangle', sampleRate: 44100, bpm: 300, fadeOut: {from: 0.8, to: 1}},
        audio: {volume: 0.2}
      },
      notes: [
        -26, -26, -26, -26, -26, -26, -26, -26,
        -28, -28, -28, -28, -28, -28, -28, -28,
        -26, -26, -26, -26, -26, -26, -26, -26,
        -19, -19, -19, -19, -19, -19, -19, -19,

        -26, -26, -26, -26, -26, -26, -26, -26,
        -28, -28, -28, -28, -28, -28, -28, -28,
        -26, -26, -26, -26, -26, -26, -26, -26,
        -19, -19, -21, -21, -22, -22, -2, -2
      ]
    }, {
      name: 'noise',
      config: {
        instrument: {waveform: 'noise', sampleRate: 44100, bpm: 300, waveEndsBy: 0.8},
        audio: {volume: 0.1}
      },
      notes: [
        [0, 0.5], [null, 2.5], [0, 0.5], [0, 0.5], [0, 0.5], [null, 0.5], [0, 0.5], [null, 0.5], [0, 0.5], [null, 0.5], [0, 0.5], [null, 0.5], [0, 0.5], [null, 1], [0, 0.5], [0, 0.5], [null, 2.5],
        [null, 3],
        [0, 0.5], [null, 2.5], [0, 0.5], [0, 0.5], [0, 0.5], [null, 0.5], [0, 0.5], [null, 0.5], [0, 0.5], [null, 0.5], [0, 0.5], [null, 0.5], [0, 0.5], [0, 0.5], [0, 0.5], [null, 4.5],
        [null, 2],
        [0, 0.5], [null, 2.5], [0, 0.5], [0, 0.5], [0, 0.5], [null, 0.5], [0, 0.5], [null, 0.5], [0, 0.5], [null, 0.5], [0, 0.5], [null, 0.5], [0, 0.5], [null, 1], [0, 0.5], [0, 0.5], [null, 2.5],
        [null, 3],
        [0, 0.5], [null, 2.5], [0, 0.5], [0, 0.5], [0, 0.5], [null, 0.5], [0, 0.5], [null, 0.5], [0, 0.5], [null, 0.5], [0, 0.5], [null, 0.5], [0, 0.5], [0, 0.5], [0, 0.5], [null, 4.5],
        [null, 2]
      ]
    }],
    loop: false
  }

  var main = {
    channels: [{
      name: 'square1',
      config: {
        instrument: {waveform: 'square', sampleRate: 44100, bpm: 300, volume: 0.2, waveEndsBy: 0.75},
        audio: {volume: 0.2}
      },
      notes: (function () {
        var overtune = [
          [6, 0.5], [4, 0.5], [6, 0.5], [9, 1.5], [6, 0.5], [null, 0.5],
          [6, 0.5], [4, 0.5], [6, 0.5], [9, 1.5], [6, 0.5], [null, 0.5],
          [6, 0.5], [4, 0.5], [6, 0.5], [9, 1.5], [6, 0.5], [null, 0.5],
          [11, 2], [9, 2],
          [6, 0.5], [4, 0.5], [6, 0.5], [9, 1.5], [6, 0.5], [null, 0.5],
          [6, 0.5], [4, 0.5], [6, 0.5], [9, 1.5], [6, 0.5], [null, 0.5],
          [6, 0.5], [4, 0.5], [6, 0.5], [9, 1.5], [6, 0.5], [null, 0.5],
          [11, 2], [9, 2],
          [6, 0.5], [4, 0.5], [6, 0.5], [9, 1.5], [6, 0.5], [null, 0.5],
          [6, 0.5], [4, 0.5], [6, 0.5], [9, 1.5], [6, 0.5], [null, 0.5],
          [6, 0.5], [4, 0.5], [6, 0.5], [9, 1.5], [6, 0.5], [null, 0.5],
          [11, 2], [9, 2],
          [6, 0.5], [6, 0.5], null, null, [9, 0.5], [9, 0.5], null, null, [11, 0.5], [11, 0.5], null, null,
          [13, 0.5], [null, 0.5], [13, 0.5], [13, 0.5], [13, 0.5], [13, 0.5], [13, 0.5], [null, 1.5], [13, 2]
        ]

        var verse = [
          -6, -3, [1, 0.5], [6, 1.5],
          [4, 0.5], [1, 0.5], [-1, 0.5], [-3, 0.5], [-4, 0.5], [-8, 1.5],
          [-10, 1.5], [-8, 1.5], [-6, 1], [-4, 1.5], [-3, 1.5], [-1, 1], [1, 1], [-1, 0.5], [1, 10.5],
          [4, 2], [2, 2], [1, 7],
          [2, 0.5], [1, 0.5], [-1, 3], [-3, 3], [-4, 2],

          -6, -3, [1, 0.5], [6, 1.5],
          [4, 0.5], [1, 0.5], [-1, 0.5], [-3, 0.5], [-4, 0.5], [-8, 1.5],
          [-10, 1.5], [-8, 1.5], [-6, 1], [-4, 1.5], [-3, 1.5], [-1, 1], [1, 1], [-1, 0.5], [1, 10.5],
          [4, 2], [2, 2], [1, 7],
          [2, 0.5], [1, 0.5], [-1, 3], [-3, 3], [-4, 2]
        ]

        var chorus = [
          [-3, 0.5], [-4, 0.5], [-6, 0.5], [-8, 0.5], [-6, 0.5], [1, 1.5],
          [-3, 0.5], [-4, 0.5], [-6, 0.5], [-8, 0.5], [-6, 0.5], [1, 1.5],
          [-3, 0.5], [-4, 0.5], [-6, 0.5], [-8, 0.5], [-6, 0.5], [1, 1.5],
          [-1, 1.5], [-3, 1.5], -4,
          [-3, 0.5], [-4, 0.5], [-6, 0.5], [-8, 0.5], [-6, 0.5], [1, 1.5],
          [-3, 0.5], [-4, 0.5], [-6, 0.5], [-8, 0.5], [-6, 0.5], [1, 1.5],
          [-3, 0.5], [-4, 0.5], [-6, 0.5], [-8, 0.5], [-6, 0.5], [1, 1.5],
          [-1, 1.5], [-3, 1.5], -4,

          [-6, 1.5], [-4, 1.5], -3,
          [-4, 1.5], [-3, 1.5], -1,
          [1, 1.5], [-1, 1.5], -3,
          [-4, 2], [-8, 2],
          [-10, 1.5], [-8, 1.5], -6,
          [-4, 1.5], [-3, 1.5], -1,
          [1, 1], [null, 2.5], [1, 0.5], [1, 0.5],
          [1, 0.5], [null, 1.5], [1, 2]
        ]

        return overtune
          .concat(verse)
          .concat(chorus)
      })()
    }, {
      name: 'square2',
      config: {
        instrument: {waveform: 'square', sampleRate: 44100, bpm: 300, waveEndsBy: 0.7},
        audio: {volume: 0.2}
      },
      notes: (function () {
        var overtune = [
          [1, 0.5], [1, 0.5], [1, 0.5], [6, 0.5], [6, 0.5], [1, 0.5], [null, 0.5], [1, 0.5],
          [1, 0.5], [1, 0.5], [1, 0.5], [6, 0.5], [6, 0.5], [1, 0.5], [null, 0.5], [1, 0.5],
          [1, 0.5], [1, 0.5], [1, 0.5], [6, 0.5], [6, 0.5], [1, 0.5], [null, 0.5], [1, 0.5],
          [6, 2], [4, 2],
          [1, 0.5], [1, 0.5], [1, 0.5], [6, 0.5], [6, 0.5], [1, 0.5], [null, 0.5], [1, 0.5],
          [1, 0.5], [1, 0.5], [1, 0.5], [6, 0.5], [6, 0.5], [1, 0.5], [null, 0.5], [1, 0.5],
          [1, 0.5], [1, 0.5], [1, 0.5], [6, 0.5], [6, 0.5], [1, 0.5], [null, 0.5], [1, 0.5],
          [6, 2], [4, 2],
          [1, 0.5], [1, 0.5], [1, 0.5], [6, 0.5], [6, 0.5], [1, 0.5], [null, 0.5], [1, 0.5],
          [1, 0.5], [1, 0.5], [1, 0.5], [6, 0.5], [6, 0.5], [1, 0.5], [null, 0.5], [1, 0.5],
          [1, 0.5], [1, 0.5], [1, 0.5], [6, 0.5], [6, 0.5], [1, 0.5], [null, 0.5], [1, 0.5],
          [6, 2], [4, 2],
          [1, 0.5], [1, 0.5], null, null, [4, 0.5], [4, 0.5], null, null, [6, 0.5], [6, 0.5], null, null,
          [8, 0.5], [null, 0.5], [8, 0.5], [8, 0.5], [8, 0.5], [8, 0.5], [8, 0.5], [null, 1.5], [8, 2]
        ]

        var verse = _.flatten(_.map(_.times(6), _.constant([
          [-11, 0.5], [null, 0.5], [-11, 0.5], [-11, 0.5],
          [-11, 0.5], [null, 0.5], [-11, 0.5], [-11, 0.5],
          [-13, 0.5], [null, 0.5], [-13, 0.5], [-13, 0.5],
          [-13, 0.5], [null, 0.5], [-13, 0.5], [-13, 0.5],
          [-15, 0.5], [null, 0.5], [-15, 0.5], [-15, 0.5],
          [-15, 0.5], [null, 0.5], [-15, 0.5], [-15, 0.5],
          [-13, 0.5], [null, 0.5], [-13, 0.5], [-13, 0.5],
          [-13, 0.5], [null, 0.5], [-13, 0.5], [-13, 0.5]
        ])))

        var chorus = [
          [-6, 0.5], null, [-6, 0.5], [null, 2],
          [-6, 0.5], null, [-6, 0.5], [null, 2],
          [-6, 0.5], null, [-6, 0.5], [null, 2],
          [-8, 0.5], null, [-8, 2.5],
          [-6, 0.5], null, [-6, 0.5], [null, 2],
          [-6, 0.5], null, [-6, 0.5], [null, 2],
          [-6, 0.5], null, [-6, 0.5], [null, 2],
          [-8, 0.5], null, [-8, 2.5],

          [-10, 2], [-10, 2], [-8, 2], [-8, 2], [-8, 2], [-8, 2], [-8, 2], [-8, 2],
          [-10, 2], [-10, 2], [-8, 2], [-8, 2],
          [-4, 1], [null, 2.5], [-4, 0.5], [-4, 0.5],
          [-4, 0.5], [null, 1.5], [-4, 2]
        ]

        return overtune
          .concat(verse)
          .concat(chorus)
      })()
    }, {
      name: 'triangle',
      config: {
        instrument: {waveform: 'triangle', sampleRate: 44100, bpm: 300, fadeOut: {from: 0.8, to: 1}},
        audio: {volume: 0.2}
      },
      notes: (function () {
        var overtune = [
          -18, -18, -18, -18,
          -18, -18, -18, -18,
          -18, -18, -18, -18,
          [-13, 2], [-15, 2],
          -18, -18, -18, -18,
          -18, -18, -18, -18,
          -18, -18, -18, -18,
          [-13, 2], [-15, 2],
          -18, -18, -18, -18,
          -18, -18, -18, -18,
          -18, -18, -18, -18,
          [-13, 2], [-15, 2],

          [-30, 0.5], [-30, 0.5], null, null, [-27, 0.5], [-27, 0.5], null, null, [-25, 0.5], [-25, 0.5], null, null,
          [-23, 0.5], [null, 0.5], [-23, 0.5], [-23, 0.5], [-23, 0.5], [-23, 0.5], [-23, 0.5], [null, 1.5], [-23, 2]
        ]

        var verse = _.flatten(_.map(_.times(6), _.constant([
          -18, [-18, 0.5], [-18, 0.5],
          -18, [-18, 0.5], [-18, 0.5],
          -20, [-20, 0.5], [-20, 0.5],
          -20, [-20, 0.5], [-20, 0.5],
          -22, [-22, 0.5], [-22, 0.5],
          -22, [-22, 0.5], [-22, 0.5],
          -20, [-20, 0.5], [-20, 0.5],
          -20, [-20, 0.5], [-20, 0.5]
        ])))

        var chorus = [
          -18, -18, -18, -18, -18, -18, -18, -18,
          -18, -18, -18, -18, -20, -20, -20, -20,
          -18, -18, -18, -18, -18, -18, -18, -18,
          -18, -18, -18, -18, -20, -20, -20, -20,

          -22, -22, -22, -22, -20, -20, -20, -20,
          -27, -27, -27, -27, -20, -20, -20, -20,
          -22, -22, -22, -22, -20, -20, -20, -20,
          [-23, 1], [null, 2.5], [-23, 0.5], [-23, 0.5],
          [-23, 0.5], [null, 1.5], [-23, 2]
        ]

        return overtune
          .concat(verse)
          .concat(chorus)
      })()
    }, {
      name: 'noise',
      config: {
        instrument: {waveform: 'noise', sampleRate: 44100, bpm: 300, waveEndsBy: 0.8},
        audio: {volume: 0.1}
      },
      notes: (function () {
        var overtune = [
          [null, 2], [0, 0.5], [null, 1.5],
          [null, 2], [0, 0.5], [null, 1.5],
          [null, 2], [0, 0.5], [null, 1.5],
          [null, 4],
          [null, 2], [0, 0.5], [null, 1.5],
          [null, 2], [0, 0.5], [null, 1.5],
          [null, 2], [0, 0.5], [null, 1.5],
          [null, 4],
          [null, 2], [0, 0.5], [null, 1.5],
          [null, 2], [0, 0.5], [null, 1.5],
          [null, 2], [0, 0.5], [null, 1.5],
          [null, 4],
          [6, 0.5], [6, 0.5], null, null, [9, 0.5], [9, 0.5], null, null, [11, 0.5], [11, 0.5], null, null,
          [13, 0.5], [null, 0.5], [13, 0.5], [13, 0.5], [13, 0.5], [13, 0.5], [13, 0.5], [null, 1.5], [null, 2]
        ]

        var verse = _.flatten(_.map(_.times(24), _.constant([
          [0, 0.1], [null, 0.9], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [0, 0.8], [null, 0.2], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4]
        ])))

        var chorus = [
          [0, 0.1], [null, 0.9], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [0, 0.8], [null, 0.2], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [0, 0.1], [null, 0.9], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [0, 0.8], [null, 0.2], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [0, 0.1], [null, 0.9], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [0, 0.8], [null, 0.2], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [null, 4],
          [0, 0.1], [null, 0.9], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [0, 0.8], [null, 0.2], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [0, 0.1], [null, 0.9], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [0, 0.8], [null, 0.2], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [0, 0.1], [null, 0.9], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [0, 0.8], [null, 0.2], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [null, 4],
          [0, 0.1], [null, 0.9], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [0, 0.8], [null, 0.2], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [0, 0.1], [null, 0.9], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [0, 0.8], [null, 0.2], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [0, 0.1], [null, 0.9], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [0, 0.8], [null, 0.2], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [0, 0.1], [null, 0.9], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [0, 0.8], [null, 0.2], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],

          [0, 0.1], [null, 0.9], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [0, 0.8], [null, 0.2], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [0, 0.1], [null, 0.9], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],
          [0, 0.8], [null, 0.2], [0, 0.1], [null, 0.4], [0, 0.1], [null, 0.4],

          [0, 0.8], [null, 0.2], [null, 2.5], [0, 0.4], [null, 0.1], [0, 0.4], [null, 0.1],
          [0, 0.4], [null, 0.1], [null, 1.5], [0, 2]
        ]

        return overtune
          .concat(verse)
          .concat(chorus)
      })()
    }],
    loop: true
  }

  var chapters = [prelude, main]
  dispatchEvent(new CustomEvent('chaptersLoaded', {detail: chapters}))
})()
